import r from"through";import e from"buffer";var t="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var a={};function Bzip2Error(r){(this||t).name="Bzip2Error";(this||t).message=r;(this||t).stack=(new Error).stack}Bzip2Error.prototype=new Error;var o={Error:function(r){throw new Bzip2Error(r)}};var n={};n.Bzip2Error=Bzip2Error;n.crcTable=[0,79764919,159529838,222504665,319059676,398814059,445009330,507990021,638119352,583659535,797628118,726387553,890018660,835552979,1015980042,944750013,1276238704,1221641927,1167319070,1095957929,1595256236,1540665371,1452775106,1381403509,1780037320,1859660671,1671105958,1733955601,2031960084,2111593891,1889500026,1952343757,2552477408,2632100695,2443283854,2506133561,2334638140,2414271883,2191915858,2254759653,3190512472,3135915759,3081330742,3009969537,2905550212,2850959411,2762807018,2691435357,3560074640,3505614887,3719321342,3648080713,3342211916,3287746299,3467911202,3396681109,4063920168,4143685023,4223187782,4286162673,3779000052,3858754371,3904687514,3967668269,881225847,809987520,1023691545,969234094,662832811,591600412,771767749,717299826,311336399,374308984,453813921,533576470,25881363,88864420,134795389,214552010,2023205639,2086057648,1897238633,1976864222,1804852699,1867694188,1645340341,1724971778,1587496639,1516133128,1461550545,1406951526,1302016099,1230646740,1142491917,1087903418,2896545431,2825181984,2770861561,2716262478,3215044683,3143675388,3055782693,3001194130,2326604591,2389456536,2200899649,2280525302,2578013683,2640855108,2418763421,2498394922,3769900519,3832873040,3912640137,3992402750,4088425275,4151408268,4197601365,4277358050,3334271071,3263032808,3476998961,3422541446,3585640067,3514407732,3694837229,3640369242,1762451694,1842216281,1619975040,1682949687,2047383090,2127137669,1938468188,2001449195,1325665622,1271206113,1183200824,1111960463,1543535498,1489069629,1434599652,1363369299,622672798,568075817,748617968,677256519,907627842,853037301,1067152940,995781531,51762726,131386257,177728840,240578815,269590778,349224269,429104020,491947555,4046411278,4126034873,4172115296,4234965207,3794477266,3874110821,3953728444,4016571915,3609705398,3555108353,3735388376,3664026991,3290680682,3236090077,3449943556,3378572211,3174993278,3120533705,3032266256,2961025959,2923101090,2868635157,2813903052,2742672763,2604032198,2683796849,2461293480,2524268063,2284983834,2364738477,2175806836,2238787779,1569362073,1498123566,1409854455,1355396672,1317987909,1246755826,1192025387,1137557660,2072149281,2135122070,1912620623,1992383480,1753615357,1816598090,1627664531,1707420964,295390185,358241886,404320391,483945776,43990325,106832002,186451547,266083308,932423249,861060070,1041341759,986742920,613929101,542559546,756411363,701822548,3316196985,3244833742,3425377559,3370778784,3601682597,3530312978,3744426955,3689838204,3819031489,3881883254,3928223919,4007849240,4037393693,4100235434,4180117107,4259748804,2310601993,2373574846,2151335527,2231098320,2596047829,2659030626,2470359227,2550115596,2947551409,2876312838,2788305887,2733848168,3165939309,3094707162,3040238851,2985771188];n.array=function(r){var e=0,t=0;var a=[0,1,3,7,15,31,63,127,255];return function(o){var n=0;while(o>0){var i=8-e;if(o>=i){n<<=i;n|=a[i]&r[t++];e=0;o-=i}else{n<<=o;n|=(r[t]&a[o]<<8-o-e)>>8-o-e;e+=o;o=0}}return n}};n.simple=function(r,e){var t=n.array(r);var a=n.header(t);var o=false;var i=1e5*a;var s=new Int32Array(i);do{o=n.decompress(t,e,s,i)}while(!o)};n.header=function(r){(this||t).byteCount=new Int32Array(256);(this||t).symToByte=new Uint8Array(256);(this||t).mtfSymbol=new Int32Array(256);(this||t).selectors=new Uint8Array(32768);4348520!=r(8*3)&&o.Error("No magic number found");var e=r(8)-48;(e<1||e>9)&&o.Error("Not a BZIP archive");return e};n.decompress=function(r,e,a,n,i){var s=20;var l=258;var u=0;var v=1;var m=50;var h=0^-1;for(var y="",b=0;b<6;b++)y+=r(8).toString(16);if("177245385090"==y){var c=0|r(32);c!==i&&o.Error("Error in bzip2: crc32 do not match");r(null);return null}"314159265359"!=y&&o.Error("eek not valid bzip data");var p=0|r(32);r(1)&&o.Error("unsupported obsolete version");var d=r(24);d>n&&o.Error("Initial position larger than buffer size");var w=r(16);var E=0;for(b=0;b<16;b++)if(w&1<<15-b){var g=r(16);for(A=0;A<16;A++)g&1<<15-A&&((this||t).symToByte[E++]=16*b+A)}var B=r(3);(B<2||B>6)&&o.Error("another error");var S=r(15);0==S&&o.Error("meh");for(var b=0;b<B;b++)(this||t).mtfSymbol[b]=b;for(var b=0;b<S;b++){for(var A=0;r(1);A++)A>=B&&o.Error("whoops another error");var I=(this||t).mtfSymbol[A];for(var g=A-1;g>=0;g--)(this||t).mtfSymbol[g+1]=(this||t).mtfSymbol[g];(this||t).mtfSymbol[0]=I;(this||t).selectors[b]=I}var z=E+2;var k=[];var T=new Uint8Array(l),C=new Uint16Array(s+1);var L;for(var A=0;A<B;A++){w=r(5);for(var b=0;b<z;b++){while(true){(w<1||w>s)&&o.Error("I gave up a while ago on writing error messages");if(!r(1))break;r(1)?w--:w++}T[b]=w}var R,U;R=U=T[0];for(var b=1;b<z;b++)T[b]>U?U=T[b]:T[b]<R&&(R=T[b]);L=k[A]={};L.permute=new Int32Array(l);L.limit=new Int32Array(s+1);L.base=new Int32Array(s+1);L.minLen=R;L.maxLen=U;var x=L.base;var Q=L.limit;var q=0;for(var b=R;b<=U;b++)for(var w=0;w<z;w++)T[w]==b&&(L.permute[q++]=w);for(b=R;b<=U;b++)C[b]=Q[b]=0;for(b=0;b<z;b++)C[T[b]]++;q=w=0;for(b=R;b<U;b++){q+=C[b];Q[b]=q-1;q<<=1;x[b+1]=q-(w+=C[b])}Q[U]=q+C[U]-1;x[R]=0}for(var b=0;b<256;b++){(this||t).mtfSymbol[b]=b;(this||t).byteCount[b]=0}var N,P,z,Z;N=P=z=Z=0;while(true){if(!z--){z=m-1;Z>=S&&o.Error("meow i'm a kitty, that's an error");L=k[(this||t).selectors[Z++]];x=L.base;Q=L.limit}b=L.minLen;A=r(b);while(true){b>L.maxLen&&o.Error("rawr i'm a dinosaur");if(A<=Q[b])break;b++;A=A<<1|r(1)}A-=x[b];(A<0||A>=l)&&o.Error("moo i'm a cow");var j=L.permute[A];if(j!=u&&j!=v){if(N){N=0;P+w>n&&o.Error("Boom.");I=(this||t).symToByte[(this||t).mtfSymbol[0]];(this||t).byteCount[I]+=w;while(w--)a[P++]=I}if(j>E)break;P>=n&&o.Error("I can't think of anything. Error");b=j-1;I=(this||t).mtfSymbol[b];for(var g=b-1;g>=0;g--)(this||t).mtfSymbol[g+1]=(this||t).mtfSymbol[g];(this||t).mtfSymbol[0]=I;I=(this||t).symToByte[I];(this||t).byteCount[I]++;a[P++]=I}else{if(!N){N=1;w=0}w+=j==u?N:2*N;N<<=1}}(d<0||d>=P)&&o.Error("I'm a monkey and I'm throwing something at someone, namely you");var A=0;for(var b=0;b<256;b++){g=A+(this||t).byteCount[b];(this||t).byteCount[b]=A;A=g}for(var b=0;b<P;b++){I=255&a[b];a[(this||t).byteCount[I]]|=b<<8;(this||t).byteCount[I]++}var D=0,F=0,G=0;if(P){D=a[d];F=255&D;D>>=8;G=-1}P=P;var H,J,K;while(P){P--;J=F;D=a[D];F=255&D;D>>=8;if(3==G++){H=F;K=J;F=-1}else{H=1;K=F}while(H--){h=4294967295&(h<<8^(this||t).crcTable[255&(h>>24^K)]);e(K)}F!=J&&(G=0)}h=(-1^h)>>>0;(0|h)!=(0|p)&&o.Error("Error in bzip2: crc32 do not match");i=4294967295&(h^(i<<1|i>>>31));return i};a=n;var i=a;var s={};var l=[0,1,3,7,15,31,63,127,255];s=function bitIterator(r){var e=0,t=0;var a=r();var f=function(o){if(null!==o||0==e){var n=0;while(o>0){if(t>=a.length){t=0;a=r()}var i=8-e;0===e&&o>0&&f.bytesRead++;if(o>=i){n<<=i;n|=l[i]&a[t++];e=0;o-=i}else{n<<=o;n|=(a[t]&l[o]<<8-o-e)>>8-o-e;e+=o;o=0}}return n}e=0;t++};f.bytesRead=0;return f};var u=s;var v="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var m={};var h=e.Buffer;var y=r;var b=i;var c=u;m=unbzip2Stream;function unbzip2Stream(){var r=[];var e=0;var t=0;var a=false;var o=false;var n=null;var i=null;function decompressBlock(r){if(t){var e=1e5*t;var a=new Int32Array(e);var o=[];var f=function(r){o.push(r)};i=b.decompress(n,f,a,e,i);if(null===i){t=0;return false}r(h.from(o));return true}t=b.header(n);i=0;return true}var s=0;function decompressAndQueue(r){if(!a)try{return decompressBlock((function(e){r.queue(e);null!==e&&(s+=e.length)}))}catch(e){r.emit("error",e);a=true;return false}}return y((function write(o){r.push(o);e+=o.length;null===n&&(n=c((function(){return r.shift()})));while(!a&&e-n.bytesRead+1>=(25e3+1e5*t||4))decompressAndQueue(this||v)}),(function end(r){while(!a&&n&&e>n.bytesRead)decompressAndQueue(this||v);if(!a){null!==i&&this.emit("error",new Error("input stream ended prematurely"));this.queue(null)}}))}var p=m;export default p;

