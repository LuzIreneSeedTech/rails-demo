import e from"events";import t from"json-buffer";var s={};function _nullRequire(e){var t=new Error("Cannot find module '"+e+"'");t.code="MODULE_NOT_FOUND";throw t}const r=e;const o=t;const loadStore=e=>{const t={redis:"@keyv/redis",mongodb:"@keyv/mongo",mongo:"@keyv/mongo",sqlite:"@keyv/sqlite",postgresql:"@keyv/postgres",postgres:"@keyv/postgres",mysql:"@keyv/mysql"};if(e.adapter||e.uri){const s=e.adapter||/^[^:]*/.exec(e.uri)[0];return new(_nullRequire(t[s]))(e)}return new Map};class Keyv extends r{constructor(e,t){super();this.opts=Object.assign({namespace:"keyv"},"string"===typeof e?{uri:e}:e,t);if(!this.opts.store){const e=Object.assign({},this.opts);this.opts.store=loadStore(e)}"function"===typeof this.opts.store.on&&this.opts.store.on("error",e=>this.emit("error",e));this.opts.store.namespace=this.opts.namespace}_getKeyPrefix(e){return`${this.opts.namespace}:${e}`}get(e){e=this._getKeyPrefix(e);const t=this.opts.store;return Promise.resolve().then(()=>t.get(e)).then(t=>{t="string"===typeof t?o.parse(t):t;if(void 0!==t){if(!("number"===typeof t.expires&&Date.now()>t.expires))return t.value;this.delete(e)}})}set(e,t,s){e=this._getKeyPrefix(e);"undefined"===typeof s&&(s=this.opts.ttl);0===s&&(s=void 0);const r=this.opts.store;return Promise.resolve().then(()=>{const n="number"===typeof s?Date.now()+s:null;t={value:t,expires:n};return r.set(e,o.stringify(t),s)}).then(()=>true)}delete(e){e=this._getKeyPrefix(e);const t=this.opts.store;return Promise.resolve().then(()=>t.delete(e))}clear(){const e=this.opts.store;return Promise.resolve().then(()=>e.clear())}}s=Keyv;var n=s;export default n;

