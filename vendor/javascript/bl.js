import t from"readable-stream/duplex";import e from"util";import i from"safe-buffer";var s="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var f={};var n=t,r=e,u=i.Buffer;function BufferList(t){if(!((this||s)instanceof BufferList))return new BufferList(t);(this||s)._bufs=[];(this||s).length=0;if("function"==typeof t){(this||s)._callback=t;var e=function piper(t){if((this||s)._callback){this._callback(t);(this||s)._callback=null}}.bind(this||s);this.on("pipe",(function onPipe(t){t.on("error",e)}));this.on("unpipe",(function onUnpipe(t){t.removeListener("error",e)}))}else this.append(t);n.call(this||s)}r.inherits(BufferList,n);BufferList.prototype._offset=function _offset(t){var e=0,i=0,f;if(0===t)return[0,0];for(;i<(this||s)._bufs.length;i++){f=e+(this||s)._bufs[i].length;if(t<f||i==(this||s)._bufs.length-1)return[i,t-e];e=f}};BufferList.prototype.append=function append(t){var e=0;if(u.isBuffer(t))this._appendBuffer(t);else if(Array.isArray(t))for(;e<t.length;e++)this.append(t[e]);else if(t instanceof BufferList)for(;e<t._bufs.length;e++)this.append(t._bufs[e]);else if(null!=t){"number"==typeof t&&(t=t.toString());this._appendBuffer(u.from(t))}return this||s};BufferList.prototype._appendBuffer=function appendBuffer(t){(this||s)._bufs.push(t);(this||s).length+=t.length};BufferList.prototype._write=function _write(t,e,i){this._appendBuffer(t);"function"==typeof i&&i()};BufferList.prototype._read=function _read(t){if(!(this||s).length)return this.push(null);t=Math.min(t,(this||s).length);this.push(this.slice(0,t));this.consume(t)};BufferList.prototype.end=function end(t){n.prototype.end.call(this||s,t);if((this||s)._callback){this._callback(null,this.slice());(this||s)._callback=null}};BufferList.prototype.get=function get(t){return this.slice(t,t+1)[0]};BufferList.prototype.slice=function slice(t,e){"number"==typeof t&&t<0&&(t+=(this||s).length);"number"==typeof e&&e<0&&(e+=(this||s).length);return this.copy(null,0,t,e)};BufferList.prototype.copy=function copy(t,e,i,f){("number"!=typeof i||i<0)&&(i=0);("number"!=typeof f||f>(this||s).length)&&(f=(this||s).length);if(i>=(this||s).length)return t||u.alloc(0);if(f<=0)return t||u.alloc(0);var copy=!!t,n=this._offset(i),r=f-i,h=r,o=copy&&e||0,l=n[1],p,a;if(0===i&&f==(this||s).length){if(!copy)return 1===(this||s)._bufs.length?(this||s)._bufs[0]:u.concat((this||s)._bufs,(this||s).length);for(a=0;a<(this||s)._bufs.length;a++){(this||s)._bufs[a].copy(t,o);o+=(this||s)._bufs[a].length}return t}if(h<=(this||s)._bufs[n[0]].length-l)return copy?(this||s)._bufs[n[0]].copy(t,e,l,l+h):(this||s)._bufs[n[0]].slice(l,l+h);copy||(t=u.allocUnsafe(r));for(a=n[0];a<(this||s)._bufs.length;a++){p=(this||s)._bufs[a].length-l;if(!(h>p)){(this||s)._bufs[a].copy(t,o,l,l+h);o+=p;break}(this||s)._bufs[a].copy(t,o,l);o+=p;h-=p;l&&(l=0)}return t.length>o?t.slice(0,o):t};BufferList.prototype.shallowSlice=function shallowSlice(t,e){t=t||0;e=e||(this||s).length;t<0&&(t+=(this||s).length);e<0&&(e+=(this||s).length);var i=this._offset(t),f=this._offset(e),n=(this||s)._bufs.slice(i[0],f[0]+1);0==f[1]?n.pop():n[n.length-1]=n[n.length-1].slice(0,f[1]);0!=i[1]&&(n[0]=n[0].slice(i[1]));return new BufferList(n)};BufferList.prototype.toString=function toString(t,e,i){return this.slice(e,i).toString(t)};BufferList.prototype.consume=function consume(t){t=Math.trunc(t);if(Number.isNaN(t)||t<=0)return this||s;while((this||s)._bufs.length){if(!(t>=(this||s)._bufs[0].length)){(this||s)._bufs[0]=(this||s)._bufs[0].slice(t);(this||s).length-=t;break}t-=(this||s)._bufs[0].length;(this||s).length-=(this||s)._bufs[0].length;(this||s)._bufs.shift()}return this||s};BufferList.prototype.duplicate=function duplicate(){var t=0,e=new BufferList;for(;t<(this||s)._bufs.length;t++)e.append((this||s)._bufs[t]);return e};BufferList.prototype.destroy=function destroy(){(this||s)._bufs.length=0;(this||s).length=0;this.push(null)};(function(){var t={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};for(var e in t)(function(e){BufferList.prototype[e]=function(i){return this.slice(i,i+t[e])[e](0)}})(e)})();f=BufferList;var h=f;export default h;

