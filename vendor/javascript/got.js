import e from"events";import t from"http";import r from"https";import o from"stream";import s from"url";import n from"fs";import i from"querystring";import c from"cacheable-request";import a from"duplexer3";import d from"into-stream";import m from"@sindresorhus/is";import u from"get-stream";import l from"timed-out";import p from"url-parse-lax";import h from"url-to-options";import f from"lowercase-keys";import g from"decompress-response";import b from"mimic-response";import y from"is-retry-allowed";import E from"isurl";import w from"p-cancelable";import T from"p-timeout";import P from"pify";import q from"safe-buffer";import v from"electron";import x from"process";var S={name:"got",version:"8.3.2",description:"Simplified HTTP requests",license:"MIT",repository:"sindresorhus/got",maintainers:[{name:"Sindre Sorhus",email:"sindresorhus@gmail.com",url:"sindresorhus.com"},{name:"Vsevolod Strukchinsky",email:"floatdrop@gmail.com",url:"github.com/floatdrop"},{name:"Alexander Tesfamichael",email:"alex.tesfamichael@gmail.com",url:"alextes.me"}],engines:{node:">=4"},scripts:{test:"xo && nyc ava",coveralls:"nyc report --reporter=text-lcov | coveralls"},files:["index.js","errors.js"],keywords:["http","https","get","got","url","uri","request","util","utility","simple","curl","wget","fetch","net","network","electron"],dependencies:{"@sindresorhus/is":"^0.7.0","cacheable-request":"^2.1.1","decompress-response":"^3.3.0",duplexer3:"^0.1.4","get-stream":"^3.0.0","into-stream":"^3.1.0","is-retry-allowed":"^1.1.0",isurl:"^1.0.0-alpha5","lowercase-keys":"^1.0.0","mimic-response":"^1.0.0","p-cancelable":"^0.4.0","p-timeout":"^2.0.1",pify:"^3.0.0","safe-buffer":"^5.1.1","timed-out":"^4.0.1","url-parse-lax":"^3.0.0","url-to-options":"^1.0.1"},devDependencies:{ava:"^0.25.0",coveralls:"^3.0.0","form-data":"^2.1.1","get-port":"^3.0.0",nyc:"^11.0.2","p-event":"^1.3.0",pem:"^1.4.4",proxyquire:"^1.8.0",sinon:"^4.0.0","slow-stream":"0.0.4",tempfile:"^2.0.0",tempy:"^0.2.1","universal-url":"1.0.0-alpha",xo:"^0.20.0"},ava:{concurrency:4},browser:{"decompress-response":false,electron:false}};var j={};const R=s;const O=t;const C=w;const U=m;class GotError extends Error{constructor(e,t,r){super(e);Error.captureStackTrace(this,this.constructor);this.name="GotError";U.undefined(t.code)||(this.code=t.code);Object.assign(this,{host:r.host,hostname:r.hostname,method:r.method,path:r.path,protocol:r.protocol,url:r.href})}}j.GotError=GotError;j.CacheError=class extends GotError{constructor(e,t){super(e.message,e,t);this.name="CacheError"}};j.RequestError=class extends GotError{constructor(e,t){super(e.message,e,t);this.name="RequestError"}};j.ReadError=class extends GotError{constructor(e,t){super(e.message,e,t);this.name="ReadError"}};j.ParseError=class extends GotError{constructor(e,t,r,o){super(`${e.message} in "${R.format(r)}": \n${o.slice(0,77)}...`,e,r);this.name="ParseError";this.statusCode=t;this.statusMessage=O.STATUS_CODES[this.statusCode]}};j.HTTPError=class extends GotError{constructor(e,t,r,o){t=t?t.replace(/\r?\n/g," ").trim():O.STATUS_CODES[e];super(`Response code ${e} (${t})`,{},o);this.name="HTTPError";this.statusCode=e;this.statusMessage=t;this.headers=r}};j.MaxRedirectsError=class extends GotError{constructor(e,t,r){super("Redirected 10 times. Aborting.",{},r);this.name="MaxRedirectsError";this.statusCode=e;this.statusMessage=O.STATUS_CODES[this.statusCode];this.redirectUrls=t}};j.UnsupportedProtocolError=class extends GotError{constructor(e){super(`Unsupported protocol "${e.protocol}"`,{},e);this.name="UnsupportedProtocolError"}};j.CancelError=C.CancelError;var G={};var A=x;const $=e;const k=t;const M=r;const H=o.PassThrough;const I=o.Transform;const _=s;const D=n;const z=i;const N=c;const B=a;const L=d;const J=m;const F=u;const V=l;const W=p;const K=h;const Q=f;const X=g;const Y=b;const Z=y;const ee=E;const te=w;const re=T;const oe=P;const se=q.Buffer;const ne=S;const ie=j;const ce=new Set([300,301,302,303,304,305,307,308]);const ae=new Set([300,303,307,308]);const isFormData=e=>J.nodeStream(e)&&J.function(e.getBoundary);const getBodySize=e=>{const t=e.body;return e.headers["content-length"]?Number(e.headers["content-length"]):t||e.stream?J.string(t)?se.byteLength(t):isFormData(t)?oe(t.getLength.bind(t))():t instanceof D.ReadStream?oe(D.stat)(t.path).then(e=>e.size):J.nodeStream(t)&&J.buffer(t._buffer)?t._buffer.length:null:0};function requestAsEventEmitter(e){e=e||{};const t=new $;const r=e.href||_.resolve(_.format(e),e.path);const o=[];const s=J.object(e.agent)?e.agent:null;let n=0;let i;let c;let a=0;const get=e=>{if("http:"!==e.protocol&&"https:"!==e.protocol){t.emit("error",new got.UnsupportedProtocolError(e));return}let d="https:"===e.protocol?M:k;if(s){const t="https:"===e.protocol?"https":"http";e.agent=s[t]||e.agent}if(e.useElectronNet&&A.versions.electron){const e=v;d=e.net||e.remote.net}let m;const u=new N(d.request,e.cache);const l=u(e,s=>{clearInterval(m);t.emit("uploadProgress",{percent:1,transferred:a,total:c});const n=s.statusCode;s.url=i||r;s.requestUrl=r;const d=e.followRedirect&&"location"in s.headers;const u=d&&ce.has(n);const l=d&&ae.has(n);if(l||u&&("GET"===e.method||"HEAD"===e.method)){s.resume();303===n&&(e.method="GET");if(o.length>=10){t.emit("error",new got.MaxRedirectsError(n,o,e),null,s);return}const r=se.from(s.headers.location,"binary").toString();i=_.resolve(_.format(e),r);o.push(i);const c=Object.assign({},e,_.parse(i));t.emit("redirect",s,c);get(c)}else A.nextTick(()=>{try{getResponse(s,e,t,o)}catch(e){t.emit("error",e)}})});l.on("error",r=>{r instanceof N.RequestError?t.emit("error",new got.RequestError(r,e)):t.emit("error",new got.CacheError(r,e))});l.once("request",r=>{let o=false;r.once("abort",e=>{o=true});r.once("error",r=>{clearInterval(m);if(o)return;const s=e.retries(++n,r);s?setTimeout(get,s,e):t.emit("error",new got.RequestError(r,e))});t.once("request",e=>{t.emit("uploadProgress",{percent:0,transferred:0,total:c});const r=e.connection;if(r){const o=void 0===r.connecting?r._connecting:r.connecting;const onSocketConnect=()=>{const o=150;m=setInterval(()=>{if(r.destroyed){clearInterval(m);return}const o=a;const s=e._header?se.byteLength(e._header):0;a=r.bytesWritten-s;c&&a>c&&(a=c);a!==o&&a!==c&&t.emit("uploadProgress",{percent:c?a/c:0,transferred:a,total:c})},o)};o?r.once("connect",onSocketConnect):onSocketConnect()}});if(e.gotTimeout){clearInterval(m);V(r,e.gotTimeout)}A.nextTick(()=>{t.emit("request",r)})})};A.nextTick(()=>{Promise.resolve(getBodySize(e)).then(t=>{c=t;J.undefined(e.headers["content-length"])&&J.undefined(e.headers["transfer-encoding"])&&isFormData(e.body)&&(e.headers["content-length"]=t);get(e)}).catch(e=>{t.emit("error",e)})});return t}function getResponse(e,t,r,o){const s=Number(e.headers["content-length"])||null;let n=0;const i=new I({transform(e,t,o){n+=e.length;const i=s?n/s:0;i<1&&r.emit("downloadProgress",{percent:i,transferred:n,total:s});o(null,e)},flush(e){r.emit("downloadProgress",{percent:1,transferred:n,total:s});e()}});Y(e,i);i.redirectUrls=o;const c=true===t.decompress&&J.function(X)&&"HEAD"!==t.method?X(i):i;t.decompress||-1===["gzip","deflate"].indexOf(e.headers["content-encoding"])||(t.encoding=null);r.emit("response",c);r.emit("downloadProgress",{percent:0,transferred:0,total:s});e.pipe(i)}function asPromise(e){const timeoutFn=t=>e.gotTimeout&&e.gotTimeout.request?re(t,e.gotTimeout.request,new got.RequestError({message:"Request timed out",code:"ETIMEDOUT"},e)):t;const t=new $;const r=new te((r,o,s)=>{const n=requestAsEventEmitter(e);let i=false;s(()=>{i=true});n.on("request",t=>{i&&t.abort();s(()=>{t.abort()});if(J.nodeStream(e.body)){e.body.pipe(t);e.body=void 0}else t.end(e.body)});n.on("response",t=>{const s=J.null(e.encoding)?F.buffer(t):F(t,e);s.catch(t=>o(new got.ReadError(t,e))).then(o=>{const s=t.statusCode;const n=e.followRedirect?299:399;t.body=o;if(e.json&&t.body)try{t.body=JSON.parse(t.body)}catch(t){if(s>=200&&s<300)throw new got.ParseError(t,s,e,o)}if(e.throwHttpErrors&&304!==s&&(s<200||s>n))throw new got.HTTPError(s,t.statusMessage,t.headers,e);r(t)}).catch(e=>{Object.defineProperty(e,"response",{value:t});o(e)})});n.once("error",o);n.on("redirect",t.emit.bind(t,"redirect"));n.on("uploadProgress",t.emit.bind(t,"uploadProgress"));n.on("downloadProgress",t.emit.bind(t,"downloadProgress"))});Object.defineProperty(r,"canceled",{get(){return r.isCanceled}});const o=timeoutFn(r);o.cancel=r.cancel.bind(r);o.on=(e,r)=>{t.on(e,r);return o};return o}function asStream(e){e.stream=true;const t=new H;const r=new H;const o=B(t,r);let s;e.gotTimeout&&e.gotTimeout.request&&(s=setTimeout(()=>{o.emit("error",new got.RequestError({message:"Request timed out",code:"ETIMEDOUT"},e))},e.gotTimeout.request));if(e.json)throw new Error("Got can not be used as a stream when the `json` option is used");e.body&&(o.write=()=>{throw new Error("Got's stream is not writable when the `body` option is used")});const n=requestAsEventEmitter(e);n.on("request",r=>{o.emit("request",r);J.nodeStream(e.body)?e.body.pipe(r):e.body?r.end(e.body):"POST"!==e.method&&"PUT"!==e.method&&"PATCH"!==e.method?r.end():t.pipe(r)});n.on("response",t=>{clearTimeout(s);const n=t.statusCode;t.on("error",t=>{o.emit("error",new got.ReadError(t,e))});t.pipe(r);e.throwHttpErrors&&304!==n&&(n<200||n>299)?o.emit("error",new got.HTTPError(n,t.statusMessage,t.headers,e),null,t):o.emit("response",t)});n.on("error",o.emit.bind(o,"error"));n.on("redirect",o.emit.bind(o,"redirect"));n.on("uploadProgress",o.emit.bind(o,"uploadProgress"));n.on("downloadProgress",o.emit.bind(o,"downloadProgress"));return o}function normalizeArguments(e,t){if(!J.string(e)&&!J.object(e))throw new TypeError(`Parameter \`url\` must be a string or object, not ${J(e)}`);if(J.string(e)){e=e.replace(/^unix:/,"http://$&");try{decodeURI(e)}catch(e){throw new Error("Parameter `url` must contain valid UTF-8 character sequences")}e=W(e);if(e.auth)throw new Error("Basic authentication must be done with the `auth` option")}else ee.lenient(e)&&(e=K(e));t=Object.assign({path:"",retries:2,cache:false,decompress:true,useElectronNet:false,throwHttpErrors:true},e,{protocol:e.protocol||"http:"},t);const r=Q(t.headers);for(const e of Object.keys(r))J.nullOrUndefined(r[e])&&delete r[e];t.headers=Object.assign({"user-agent":`${ne.name}/${ne.version} (https://github.com/sindresorhus/got)`},r);t.decompress&&J.undefined(t.headers["accept-encoding"])&&(t.headers["accept-encoding"]="gzip, deflate");const o=t.query;if(o){J.string(o)||(t.query=z.stringify(o));t.path=`${t.path.split("?")[0]}?${t.query}`;delete t.query}t.json&&J.undefined(t.headers.accept)&&(t.headers.accept="application/json");const s=t.body;if(J.nullOrUndefined(s))t.method=(t.method||"GET").toUpperCase();else{const e=t.headers;if(!J.nodeStream(s)&&!J.string(s)&&!J.buffer(s)&&!(t.form||t.json))throw new TypeError("The `body` option must be a stream.Readable, string, Buffer or plain Object");const r=J.plainObject(s)||J.array(s);if((t.form||t.json)&&!r)throw new TypeError("The `body` option must be a plain Object or Array when the `form` or `json` option is used");if(isFormData(s))e["content-type"]=e["content-type"]||`multipart/form-data; boundary=${s.getBoundary()}`;else if(t.form&&r){e["content-type"]=e["content-type"]||"application/x-www-form-urlencoded";t.body=z.stringify(s)}else if(t.json&&r){e["content-type"]=e["content-type"]||"application/json";t.body=JSON.stringify(s)}if(J.undefined(e["content-length"])&&J.undefined(e["transfer-encoding"])&&!J.nodeStream(s)){const r=J.string(t.body)?se.byteLength(t.body):t.body.length;e["content-length"]=r}if(J.buffer(s)){t.body=L(s);t.body._buffer=s}t.method=(t.method||"POST").toUpperCase()}if("unix"===t.hostname){const e=/(.+?):(.+)/.exec(t.path);if(e){t.socketPath=e[1];t.path=e[2];t.host=null}}if(!J.function(t.retries)){const e=t.retries;t.retries=(t,r)=>{if(t>e||!Z(r))return 0;const o=100*Math.random();return 1e3*(1<<t)+o}}J.undefined(t.followRedirect)&&(t.followRedirect=true);if(t.timeout){J.number(t.timeout)?t.gotTimeout={request:t.timeout}:t.gotTimeout=t.timeout;delete t.timeout}return t}function got(e,t){try{const r=normalizeArguments(e,t);return r.stream?asStream(r):asPromise(r)}catch(e){return Promise.reject(e)}}got.stream=(e,t)=>asStream(normalizeArguments(e,t));const de=["get","post","put","patch","head","delete"];for(const e of de){got[e]=(t,r)=>got(t,Object.assign({},r,{method:e}));got.stream[e]=(t,r)=>got.stream(t,Object.assign({},r,{method:e}))}Object.assign(got,ie);G=got;var me=G;export default me;

